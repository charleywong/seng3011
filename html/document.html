<!DOCTYPE html>

<html>
<head>
<style>
table, th, td {
    border: 1px solid black;
}
</style>
</head>

<body>
<h1>Documentation</h1>

<h2>API</h2>
<p>Input is parsed as a query string.</p>
<h3>Parameters</h3>
<p>The parameters include: </p>
<ul>
	<li>InstrumentID (company)</li>
	<li>Date of Interest (date of interest)</li>
	<li>List of Var (either CM_Return, AV_Return)</li>
	<li>Upper Window (time of interest above date)</li>
	<li>Lower Window (time of interest below date)</li>	
</ul>
<p>An example query string is the following: <br> <a href="/api/company_returns?InstrumentID=ABP.AX&ListOfVar=CM_Return&ListOfVar=AV_Return&UpperWindow=5&LowerWindow=3&DateOfInterest=10%2F12%2F2012">/api/company_returns?InstrumentID=ABP.AX&ListOfVar=CM_Return&ListOfVar=AV_Return&UpperWindow=5&LowerWindow=3&DateOfInterest=10%2F12%2F2012</a></p>

<h2>Modules</h2>
<p>Modules include the following:</p>
<ul>
	<li>Input Parser</li>
	<li>Data Parser</li>
	<li>Table Builder</li>
	<li>Calculations</li>
</ul>

<p>Modules have the following dependencies:</p>
<ul>
	<li><a href="https://nodejs.org/api/fs.html">Node.js File System</a></li>
	<li><a href="https://lodash.com/">lodash</a></li>
	<li><a href="https://momentjs.com/">Moment.js</a></li>
	<li><a href="http://bluebirdjs.com/docs/api-reference.html">bluebird</a></li>
	<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Isomorphic Fetch</a></li>
	<li><a href="https://www.npmjs.com/package/csvtojson">csvtojson</a></li>
</ul>

<h3>Input Parser</h3>
<p>The Input Parser module is used for parsing and validating input from a GET query string. This module throws errors if data cannot be validated. </p>
<h4>Module Contents:</h4>
<ul style = "list-style-type:none">
	<li>parseInput</li>
	<li>hasNull</li>
	<li>isNumeric</li>
	<li>listIsValid</li>
</ul>


<h4>parseInput</h4>
<p>
@param {Object} parameters GET query string<br>
@param {}<br>
@returns {Object} validated data<br>
function parseInput(parameters)<br>
</p>
<p>Parses and validates query parameters from a GET Request.<br>
Validates by checking for null or dirty values. Throws an error if input is null or dirty.</p> 
<table>
  <tr>
    <th>Parameter</th>
		<th>Type</th>
    <th>Method</th>
  </tr>
  <tr>
    <td>InstrumentID</td>
		<td>String</td>
    <td>Validate IDs if they consist only of letters, commas and dots</td>
  </tr>
	<tr>
		<td>listOfVar</td>
		<td>Array</td>
		<td>Validate only if contents match CM_Return or AV_Return</td>
	</tr>
	<tr>
		<td>LowerWindow</td>
		<td>String</td>
		<td>Parse into integer using unary operator. <br>Use isNan() to validate valid numbers. Assume numbers must be positive</td>
	</tr>
	<tr>
		<td>UpperWindow</td>
		<td>String</td>
		<td>Parse into integer using unary operator. <br>
			Use isNan() to validate valid numbers. Assume numbers must be positive</td>
	</tr>
	<tr>
		<td>DateOfInterest</td>
		<td>String</td>
		<td>Parse into Javascript Date Object</td>
	</tr>
</table>

<h4>hasNull</h4>
<p>
@param {Object}<br>
@param {}<br>
@returns {}<br>
function hasNull(obj)<br>
</p>
<p>Utility function meant to be used alongside parseInput. Checks for null values in input parameters with lodash. 
<br>Throws an error if null value is found.
</p>

<h4>isNumeric</h4>
<p>
@param {Number}<br>
@param {}<br>
@returns {Bool}<br>
function isNumeric(num)<br>
</p>
<p>Utility function meant to be used alongside parseInput. Validates numbers using isNan() function and checks for negative numbers. 
<br>Throws an error if input is not numeric.
</p>

<h4>listIsValid</h4>
<p>
@param {Array}<br>
@param {}<br>
@returns {}<br>
function listIsValid(array)<br>
</p>
<p>Utility function meant to be used alongside parseInput. Checks if contents of an array match "CM_Return" or "AV_Return". 
<br>Throws an error if array contents do not match the aforementioned.
</p>
<hr>

<h3>Data Parser</h3>
<p>The Data Parser module is used to prepare and request data from a REST API using the outputs of the Input Parser.
This module returns raw csv content from the REST API.</p>
<h4>Module Contents:</h4>
<ul style = "list-style-type:none">
	<li>fetchData</li>
</ul>

<h4>fetchData</h4>
<p>
@param {Object} parameters<br>
@returns {String} Raw CSV Content<br>
fetchData = async function (parameters)
</p>
<p>Calculates a start date and end date using parameters LowerWindow, UpperWindow and date of interest. Uses this date and other parameters included to perform a url query on Yahoo's Database. <br>
Throws an error if response status code is a client error (i.e. status code has the form of 4xx).</p>
<p>Start date is calculated by: DateOfInterest - (2 * LowerWindow + 1)
<br>End date is calculated by:	DateOfInterest + (2 * UpperWindow)</p>
<hr>

<h3>Table Builder</h3>
<p>The Table Builder module is used to convert raw csv data to the JSON format. (DOES THIS RETURN AN OBJECT??).</p>
<h4>Module Contents:</h4>
<ul style = "list-style-type:none">
	<li>buildTable</li>
</ul>

<h4>buildTable</h4>
<p>
@param {String} csvData<br>
@returns {???} <br>
</p>
<p>Uses csvtojson to convert raw csv data to json format. Uses checkType (disabled by default) and toArrayString options for conversion. See <a href="https://www.npmjs.com/package/csvtojson">csvtojson docs</a> for more details.</p>
<hr>

<h3>Calculations</h3>
<p>Something something calculation</p>

<!-- /r/ProgrammerHumor -->
<!-- INSERT EASTER EGG HERE
<form>
	<input type = "button" value = "EASTER EGG!!" onclick = "showFunny()"; />
</form>

<script>
function showFunny() {
	window.location = "http://i.imgur.com/OOHAWsb.jpg";
}
</script>
-->

</body>

</html>
